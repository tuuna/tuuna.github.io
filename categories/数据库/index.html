<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>数据库 | 洛文小站</title><meta name=keywords content><meta name=description content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"><meta name=author content="Theme PaperMod"><link rel=canonical href=http://tuuna.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/><link href=http://tuuna.top/assets/css/stylesheet.min.46b233709fd2c907e04a2d946c05f4e1d6edaf81b562cbfdaf6f11aeaa32248c.css integrity="sha256-RrIzcJ/SyQfgSi2UbAX04dbtr4G1Ysv9r28RrqoyJIw=" rel="preload stylesheet" as=style><link rel=icon href=http://tuuna.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://tuuna.top/favicon16x16.png><link rel=icon type=image/png sizes=32x32 href=http://tuuna.top/favicon32x32.png><link rel=apple-touch-icon href=http://tuuna.top/apple-touch-icon.png><link rel=mask-icon href=http://tuuna.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.78.2"><link rel=alternate type=application/rss+xml href=http://tuuna.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/index.xml><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-123-45','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="数据库"><meta property="og:description" content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"><meta property="og:type" content="website"><meta property="og:url" content="http://tuuna.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><meta property="og:updated_time" content="2020-04-21T03:55:57+00:00"><meta property="og:site_name" content="洛文小站"><meta name=twitter:card content="summary"><meta name=twitter:title content="数据库"><meta name=twitter:description content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"></head><body class=list id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=http://tuuna.top accesskey=h><img src=/cloud.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span><span class=lang-switch><span>|</span><ul><li><a href=http://tuuna.top/about/ title=About aria-label=About>About</a></li></ul></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=http://tuuna.top/archives/><span>Archive</span></a></li><li><a href=http://tuuna.top/tags/><span>Tag</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>数据库</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Seata分布式事务框架的流程解析</h2></header><section class=entry-content><p>XID：全局事务的唯一标识，由 ip:port:sequence 组成； Transaction Coordinator (TC)：事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚； Transaction Manager (TM )：控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议； Resource Manager (RM)：控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚； 业务逻辑是经典的下订单、扣余额、减库存流程。 根据模块划分为三个独立的服务，且分别连接对应的数据库：
订单：order-server 账户：account-server 库存：storage-server 业务：business-server 项目结构如下图
正常业务: business发起购买请求
storage扣减库存
order创建订单
account扣减余额
异常业务： 扣减余额异常
正常流程下 2、3、4 步的数据正常更新全局 commit，异常流程下的数据则由于第 4 步的异常报错全局回滚。
使用流程及解析
首先创建相应的数据库与数据表 库名 含有的表 作用 db_account account_tbl undo_log 存储用户信息 db_order order_tbl undo_log 订单信息 db_storage storage_tbl undo_log 库存信息 注:上面的每一个库可以存储与不同的机器上面。需要在不同的服务里面配置即可...</p></section><footer class=entry-footer>April 21, 2020&nbsp;·&nbsp;2 min&nbsp;·&nbsp;赖杰</footer><a class=entry-link aria-label="post link to Seata分布式事务框架的流程解析" href=http://tuuna.top/2020/04/21/seata/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>2e数据量下MongoDB查询性能测试</h2></header><section class=entry-content><p>硬件环境：三台4核CPU、32G内存、100G磁盘 测试数据量: 1.96e
Order表结构如下：
{ "_id": ObjectId, "uid": "uid186642", //有索引 "name": "商品214", "money": 899 } 语句类型 查询语句 有无索引 测试结果(时间，返回数据量) 等值查询 db.order.find({uid:“uid150902”}) 有 7ms, 949条 等值查询 db.order.find({money:999}) 无 28.57s, 1929条 In查询 db.order.find({uid: {$in: [“uid100000”, “uid123456”, “uid089345”]}}) 有 19ms, 2860条 In查询 db.order.find({money: {$in: [300, 450, 999]}}) 无 30.37s, 5871条 范围查询 db.order.find({uid:{$gt:“uid198800”}}) 有 4.59s，117w条 范围查询 db.order.find({money:{$gt:990}}) 无 29....</p></section><footer class=entry-footer>September 29, 2019&nbsp;·&nbsp;1 min&nbsp;·&nbsp;赖杰</footer><a class=entry-link aria-label="post link to 2e数据量下MongoDB查询性能测试" href=http://tuuna.top/2019/09/29/mongo_test/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Hbase + PostgreSQL测试</h2></header><section class=entry-content><p>文章目录 Hbase + PostgreSQL测试 基本信息 测试方法 HBASE PG 测试图例 基本信息 Hbase与PG测试使用YCSB压力测试工具
采用21w行数据+21w操作数来最大化模拟20G数据场景
测试方法 HBASE 首先下载YCSB，解压
接下来创建测试数据库
hbase shell命令打开shell命令行
hbase(main):001:0> n_splits = 20 # HBase recommends (10 * number of regionservers) hbase(main):002:0> create 'usertable', 'cf', {SPLITS => (1..n_splits).map {|i| "user#{1000+i*(9999-1000)/n_splits}"}} 把hbase的conf目录下的|$HBASE_HOME/conf/hbase-site.xml(比如我本机是/usr/local/hbase/conf/hbase-site.xml)复制到我们下载的YCSB中的hbase14下的conf文件夹中
接下来装载数据
$ ./bin/ycsb load hbase14 -P workloads/workloada -p table=usertable -p columnfamily=cf -p recordcount=210000 -p operationcount=210000 -p measurementtype=hdrhistogram -p hdrhistogram....</p></section><footer class=entry-footer>September 29, 2019&nbsp;·&nbsp;3 min&nbsp;·&nbsp;赖杰</footer><a class=entry-link aria-label="post link to Hbase + PostgreSQL测试" href=http://tuuna.top/2019/09/29/hbase_postgresql_test/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>DB与FS比较</h2></header><section class=entry-content><p>文章目录 数据库以及FS比较 HDFS、Ceph差异对比 HDFS设计目标 HDFS文件目录 Ceph设计目标 Ceph数据结构 HDFS文件导出 Ceph文件导出 暂时的结论 其它FS选型 其它思路 总结 Hbase、Cassendra、TiDB适用场景以及相关生态 Hbase 基本简介 特性 优势 缺点 Cassendra 基本简介 重要特性 优势 劣势 TiDB 基本简介 特性 使用场景 生态 已存在HDFS中的解析成结果数据 导入到 SQL 从 Sqoop 中导出 HDFS、Ceph差异对比 HDFS设计目标 存储非常大的文件：这里非常大指的是几百M、G、或者TB级别。实际应用中已有很多集群存储的数据达到PB级别。根据Hadoop官网，Yahoo！的Hadoop集群约有10万颗CPU，运行在4万个机器节点上。更多世界上的Hadoop集群使用情况，参考Hadoop官网.
采用流式的数据访问方式: HDFS基于这样的一个假设：最有效的数据处理模式是一次写入、多次读取数据集经常从数据源生成或者拷贝一次，然后在其上做很多分析工作 分析工作经常读取其中的大部分数据，即使不是全部。 因此读取整个数据集所需时间比读取第一条记录的延时更重要。
运行于商业硬件上: Hadoop不需要特别贵的、reliable的机器，可运行于普通商用机器（可以从多家供应商采购） 商用机器不代表低端机器在集群中（尤其是大的集群），节点失败率是比较高的HDFS的目标是确保集群在节点失败的时候不会让用户感觉到明显的中断。...</p></section><footer class=entry-footer>September 26, 2019&nbsp;·&nbsp;2 min&nbsp;·&nbsp;赖杰</footer><a class=entry-link aria-label="post link to DB与FS比较" href=http://tuuna.top/2019/09/26/db_fs_compare/></a></article></main><footer class=footer><span>&copy; 2020 <a href=http://tuuna.top>洛文小站</a></span>
<span>&#183;</span>
<span>备案号 <a href=http://www.beian.miit.gov.cn/ rel="noopener noreferrer">蜀ICP备15022210号-3</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top" accesskey=g><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>